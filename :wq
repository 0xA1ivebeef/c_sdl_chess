
#include "utils/utils.h"

int abs_int(int x) 
{
    return x < 0 ? -x : x;
}

int char_to_promotion_flag(char c)
{   
    if (c >= 'a' && c <= 'z')
        c -= 32; // 'n' -> 'N', etc.

    switch(c)
    {
        case 'N': return 3; // KNGHT_PROMOTION
        case 'B': return 4; // BISHOP_PROMOTION
        case 'R': return 5; // ROOK_PROMOTION
        case 'Q': return 6; // QUEEN_PROMOTION
        default:
            return 6; // default to queen if invalid input
    } 
}

Move choose_promotion_move(Move* m)
{
    printf("Chose promotion piece (N/B/R/Q): ");
    char c = getchar();
    while (getchar() != '\n'); // flush buffer
                               //
    int flag = char_to_promotion_flag(c);

    Move this_move = {m->startsquare, m->destsquare, flag};
    return this_move;
}

const char* square_to_notation(int sq) 
{
    static char bufs[8][3];   // allows up to 8 simultaneous results 
    static int idx = 0;
    char *out = bufs[(idx++) & 7];

    if (sq < 0 || sq > 63) 
    {
        out[0] = out[1] = '?';
        out[2] = '\0';
        return out;
    }
    out[0] = 'a' + (sq % 8);
    out[1] = '8' - (sq / 8);
    out[2] = '\0';

    return out;
}

